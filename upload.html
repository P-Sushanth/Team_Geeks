<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<main class="container">
  <img src="logo.png" class="logo" />

  <h1 id="title">Upload File</h1>
  <p id="subtitle" class="subtitle"></p>

  <div class="upload-box" onclick="fileInput.click()">
    Click to upload
  </div>

  <input type="file" id="fileInput" hidden />

  <!-- PREVIEW AREA -->
  <div id="previewBox" style="display:none; margin:20px 0;">
    <img id="imgPreview" style="max-width:100%; border-radius:12px; display:none;" />
    <video id="videoPreview" controls style="width:100%; border-radius:12px; display:none;"></video>
    <audio id="audioPreview" controls style="width:100%; display:none;"></audio>
  </div>

  <p id="info"></p>

  <button id="checkBtn" class="primary-btn disabled" onclick="submitFile()">
    Check
  </button>

  <p id="loading" class="loading">Checking...</p>
</main>

<script>
const params = new URLSearchParams(window.location.search);
const type = params.get("type") || "video";

const title = document.getElementById("title");
const subtitle = document.getElementById("subtitle");
const fileInput = document.getElementById("fileInput");
const info = document.getElementById("info");
const checkBtn = document.getElementById("checkBtn");
const loading = document.getElementById("loading");

const previewBox = document.getElementById("previewBox");
const imgPreview = document.getElementById("imgPreview");
const videoPreview = document.getElementById("videoPreview");
const audioPreview = document.getElementById("audioPreview");

let allowed = [];
let maxMB = 0;
let file = null;

/* CONFIG BASED ON TYPE */
if (type === "image") {
  title.innerText = "Upload Image";
  subtitle.innerText = "JPG / PNG, max 3MB";
  allowed = ["image/jpeg", "image/png"];
  maxMB = 3;
  fileInput.accept = ".jpg,.png";
}

if (type === "video") {
  title.innerText = "Upload Video";
  subtitle.innerText = "MP4 / MOV, max 5MB";
  allowed = ["video/mp4", "video/quicktime"];
  maxMB = 5;
  fileInput.accept = ".mp4,.mov";
}

if (type === "audio") {
  title.innerText = "Upload Audio";
  subtitle.innerText = "MP3 / WAV, max 20MB";
  allowed = ["audio/mpeg", "audio/wav"];
  maxMB = 20;
  fileInput.accept = ".mp3,.wav";
}

/* FILE HANDLING */
fileInput.onchange = () => {
  resetPreview();
  file = fileInput.files[0];
  if (!file) return;

  if (!allowed.includes(file.type)) {
    info.innerText = "Invalid file type";
    return;
  }

  if (file.size / 1024 / 1024 > maxMB) {
    info.innerText = "File too large";
    return;
  }

  info.innerText = `Selected: ${file.name}`;
  checkBtn.classList.remove("disabled");
  showPreview(file);
};

function showPreview(file) {
  const url = URL.createObjectURL(file);
  previewBox.style.display = "block";

  if (type === "image") {
    imgPreview.src = url;
    imgPreview.style.display = "block";
  }

  if (type === "video") {
    videoPreview.src = url;
    videoPreview.style.display = "block";
  }

  if (type === "audio") {
    audioPreview.src = url;
    audioPreview.style.display = "block";
  }
}

function resetPreview() {
  previewBox.style.display = "none";
  imgPreview.style.display = "none";
  videoPreview.style.display = "none";
  audioPreview.style.display = "none";
}

/* SUBMIT (MOCK BACKEND) */
function submitFile() {
  checkBtn.classList.add("disabled");
  loading.style.display = "block";

  setTimeout(() => {
    sessionStorage.setItem(
      "analysisResult",
      JSON.stringify({
        label: "fake",
        confidence: 0.82,
        explanation: "AI-generated artifacts detected"
      })
    );
    window.location.href = "result.html";
  }, 2000);
}
</script>

</body>
</html>
